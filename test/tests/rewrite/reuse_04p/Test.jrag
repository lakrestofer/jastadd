aspect Test {

  rewrite A {
    when (getB().a() != null && !isRewritten()) to A2 {
      return new A2(getB().treeCopy());
    }
  }

  syn boolean A.isRewritten() = false;
  eq A2.isRewritten() = true;

  inh lazy A B.a();
  eq A.getB().a() = this;
}
