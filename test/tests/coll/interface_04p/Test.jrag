// Test targeted contribution to transitively inherited interface-hosted collection
// .grammar { A ::= B; B ::= <ID>; }

import static runtime.Test.*;
import java.util.HashSet;

aspect Test {
    interface I {
	public HashSet<I> targets();
    }
    B implements I;
    A implements I;

    public HashSet<I> A.targets() {
	HashSet<I> t = new HashSet<>();
	t.add(this.getB());
	return t;
    }

    inh A ASTNode.topA();
    eq A.getChild().topA() = this;
    eq ASTNode.getChild().topA() = this.topA();

    public HashSet<I> B.targets() {
	HashSet<I> t = new HashSet<>();
	t.add(this.topA());
	return t;
    }

    coll HashSet<I> I.set() [new HashSet<>()] with add;
    ASTNode contributes (I)this
	when (this instanceof I)
	to I.set()
	for each ((I)this).targets();


    public class Test {
	public static void main(String[] args) {
	    B b = new B("0");
	    A a = new A(b);

	    testTrue(a.set().contains(b));
	    testFalse(a.set().contains(a));
	    testTrue(b.set().contains(a));
	    testFalse(b.set().contains(b));
	}
    }
}
